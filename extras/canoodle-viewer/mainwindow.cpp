#include "mainwindow.h"
#include "ui_mainwindow.h"

MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    ui->setupUi(this);

    browser = new Browser(this);
    connect( ui->webView->page()->mainFrame(), SIGNAL(javaScriptWindowObjectCleared()), this, SLOT(attachBrowserObjects()) );

    int menuOffset = 0;
    #ifdef Q_OS_MAC
        // MAC, all good
    #else
        // stupid menu bar makes this too short
        menuOffset = this->menuBar()->height();
    #endif

    this->setFixedSize(960, 540 + menuOffset);
    setResolution();
    initWebKitSettings();

    initSettings();
    initialiseHistoryMenu();

    inspector = new QWebInspector();
    inspector->setWindowFlags(Qt::Tool);

    ui->actionOpen->setShortcut(QKeySequence("Ctrl+O"));
    ui->actionRemote_URL->setShortcut(QKeySequence("Ctrl+U"));
    ui->actionPrint->setShortcut(QKeySequence("Ctrl+P"));

    ui->action960_x_540->setShortcut(QKeySequence("Ctrl+1"));
    ui->action1280_x_720->setShortcut(QKeySequence("Ctrl+2"));
    ui->action1920_x_1080->setShortcut(QKeySequence("Ctrl+3"));
    ui->actionDebug->setShortcut(QKeySequence("Ctrl+D"));

    loadStaticPage(CANOODLE_WELCOME);
}

void MainWindow::attachBrowserObjects() {
    QWebFrame * frame = ui->webView->page()->mainFrame();
    frame->addToJavaScriptWindowObject(QString("browser"), browser);
}

void MainWindow::setResolution() {
    QString _resolution = settings.value("resolution").toString();
    if (_resolution == "1080p") {
        on_action1920_x_1080_triggered();
    } else if (_resolution == "540p") {
        on_action960_x_540_triggered();
    } else { // default
        on_action1280_x_720_triggered();
    }
}

void MainWindow::initWebKitSettings(){
    QWebSettings::globalSettings()->setAttribute(QWebSettings::DeveloperExtrasEnabled, true);
    QWebSettings::globalSettings()->setAttribute(QWebSettings::PluginsEnabled, true);
    QWebSettings::globalSettings()->setAttribute(QWebSettings::JavascriptEnabled, true);
    QWebSettings::globalSettings()->setAttribute(QWebSettings::JavascriptCanOpenWindows, false);
    QWebSettings::globalSettings()->setAttribute(QWebSettings::SpatialNavigationEnabled, false);
    QWebSettings::globalSettings()->setAttribute(QWebSettings::ZoomTextOnly, false);
    QWebSettings::globalSettings()->setAttribute(QWebSettings::PrintElementBackgrounds, true);
    QWebSettings::globalSettings()->setAttribute(QWebSettings::OfflineStorageDatabaseEnabled, true);
    QWebSettings::globalSettings()->setAttribute(QWebSettings::OfflineWebApplicationCacheEnabled, true);
    QWebSettings::globalSettings()->setAttribute(QWebSettings::LocalStorageEnabled, true);
    QWebSettings::globalSettings()->setAttribute(QWebSettings::LocalContentCanAccessRemoteUrls, true);
    QWebSettings::globalSettings()->setAttribute(QWebSettings::LocalContentCanAccessFileUrls, true);
    QWebSettings::globalSettings()->setAttribute(QWebSettings::XSSAuditingEnabled, false);
    QWebSettings::globalSettings()->setAttribute(QWebSettings::SiteSpecificQuirksEnabled, false);

    ui->actionQuirks->setChecked(QWebSettings::globalSettings()->testAttribute(QWebSettings::SiteSpecificQuirksEnabled));

    ui->actionScrolling->setChecked(false);
    ui->webView->page()->mainFrame()->setScrollBarPolicy(Qt::Vertical, Qt::ScrollBarAlwaysOff);
    ui->webView->page()->mainFrame()->setScrollBarPolicy(Qt::Horizontal, Qt::ScrollBarAlwaysOff);
}

void MainWindow::initSettings(){
    QString _history = settings.value("history").toString();

    QList <QString> rows = _history.split("\n");
    for (int i = 0; i < rows.length(); i++) {
        QList<QString> cols = rows.at(i).split("\t");
        if (cols.length() == 2) { // don't count dud rows
            QAction * action = new QAction(cols.at(0), this);
            action->setProperty("url", cols.at(1));
            connect(action, SIGNAL(triggered()), this, SLOT(loadHistory()));
            history.append(action);
        }
    }
}

void MainWindow::updateHistoryInSettings() {
    QString _history;
    for (int i = 0; i < history.length(); i++) {
        _history += QString("%1\t%2\n").arg(history.at(i)->text()).arg(history.at(i)->property("url").toString());
    }
    settings.setValue("history", _history);
    settings.sync();
}

MainWindow::~MainWindow()
{
    delete ui;
}

void MainWindow::on_actionDebug_triggered()
{
    if (inspector->isVisible()) {
        inspector->setFocus();
    } else {
        inspector->show();
    }
}

void MainWindow::on_actionOpen_triggered()
{
    QString path = QFileDialog::getOpenFileName(this, "Select File", QDir::homePath(), "Files (*.html)");

    if (!path.isEmpty()) {
        loadUrl(QUrl::fromLocalFile(path));
    }
}

void MainWindow::on_actionRemote_URL_triggered()
{
    bool ok;
    QString url = QInputDialog::getText(this, "Enter Location", "URL (e.g. http://www.example.com):", QLineEdit::Normal, "http://", &ok, Qt::Sheet);

    if (ok && !url.isEmpty()) {
        this->loadUrl(QUrl(url));
    }
}

void MainWindow::loadHistory() {
    loadUrl(sender()->property("url").toUrl());
}

void MainWindow::loadUrl(QUrl url) {
    browser->close();
    clearCache();
    isNewLoad = true;
    setLoadingUI();
    ui->webView->load(url);
}

void MainWindow::loadStaticPage(int type) {
    QString html = "<!DOCTYPE><html>";
    html += "<head><title>%1</title></head>";
    html += "<body><img src='%2' style='position:absolute;top:50%;left:50%;margin-left:-210px;margin-top:-75px;'/></body>";
    html += "</html>";

    QString title, image;

    switch (type) {
        case CANOODLE_WELCOME:
            title = "Welcome, Canoodler!";
            // NB: need to break the image string up because Windows can't handle very long strings: http://msdn.microsoft.com/en-us/library/dddywwsc.aspx
            image  = "data:image/png;base64,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";
            image += "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";
            this->setWindowTitle(title);
            ui->webView->setHtml(html.arg(title).arg(image));
            break;
        case CANOODLE_ERROR:
        default:
            title = "Poop! Something went wrong.";
            // NB: need to break the image string up because Windows can't handle very long strings: http://msdn.microsoft.com/en-us/library/dddywwsc.aspx
            image  = "data:image/png;base64,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";
            image += "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";
            this->setWindowTitle(title);
            ui->webView->setHtml(html.arg(title).arg(image));
            break;
    }
}

void MainWindow::on_webView_loadProgress(int progress)
{
    if (progress >= 0 && progress < 100) {
        QString title = (ui->webView->title().isEmpty()) ?
            QString("Loading ..."):
            QString("%1").arg(ui->webView->title());
        this->setWindowTitle(title);

        ui->progressBar->setValue(progress);
    } else {
        this->setWindowTitle(ui->webView->title());
    }
}

void MainWindow::setLoadingUI(){
    ui->progressBar->setVisible(true);

    QGraphicsBlurEffect * fade = new QGraphicsBlurEffect(ui->webView);
    fade->setBlurRadius(20);
    ui->webView->setGraphicsEffect(fade);
    ui->webView->setEnabled(false);
    ui->webView->setWindowOpacity(0.5);

    this->setCursor(Qt::WaitCursor);
}

void MainWindow::resetLoadingUI(){
    ui->progressBar->setVisible(false);

    QGraphicsBlurEffect * fade = new QGraphicsBlurEffect(ui->webView);
    fade->setBlurRadius(0);
    ui->webView->setGraphicsEffect(fade);
    ui->webView->setEnabled(true);
    ui->webView->setWindowOpacity(1);

    this->setCursor(Qt::ArrowCursor);
}

void MainWindow::initialiseHistoryMenu(){
    QAction * back = new QAction("Back", this);
    connect(back, SIGNAL(triggered()), this, SLOT(on_actionBack_triggered()));
    back->setShortcut(QKeySequence("BACKSPACE"));

    QAction * reload = new QAction("Reload", this);
    connect(reload, SIGNAL(triggered()), this, SLOT(on_actionReload_triggered()));
    reload->setShortcut(QKeySequence("Ctrl+R"));

    ui->menuHistory->clear();
    ui->menuHistory->addAction(back);
    ui->menuHistory->addAction(reload);

    if (history.length() > 0) {
        ui->menuHistory->addActions(history);
        ui->menuHistory->insertSeparator(history.at(0));

        QAction * clear = new QAction("Clear", this);
        connect(clear, SIGNAL(triggered()), this, SLOT(clearHistoryMenu()));
        clear->setShortcut(QKeySequence("Ctrl+C"));
        ui->menuHistory->addAction(clear);
        ui->menuHistory->insertSeparator(clear);
    }

    back->setDisabled(!ui->webView->history()->canGoBack() && !browser->isVisible());
}

void MainWindow::clearHistoryMenu(){
    history.clear();
    settings.setValue("history", "");
    initialiseHistoryMenu();
}

void MainWindow::on_webView_loadFinished(bool isLoaded)
{
    if (isLoaded) {
        inspector->setPage(ui->webView->page());
        this->setWindowTitle(ui->webView->title());
        if (isNewLoad) {
            QAction * action = new QAction(ui->webView->title(), this);
            action->setProperty("url", ui->webView->url());
            connect(action, SIGNAL(triggered()), this, SLOT(loadHistory()));

            for (int i = 0; i < history.length(); i++) {
                if (history.at(i)->property("url") == action->property("url")) {
                    history.removeAt(i);
                }
            }

            history.push_front(action);

            while (history.length() > 10) {
                history.removeLast();
            }

            updateHistoryInSettings();

            ui->webView->history()->clear();
        }
    } else {
        ui->webView->stop();
        loadStaticPage(CANOODLE_ERROR);
        if (isNewLoad) {
            ui->webView->history()->clear();
        }
    }

    isNewLoad = false;
    resetLoadingUI();
    initialiseHistoryMenu();
}

void MainWindow::on_action960_x_540_triggered()
{
    ui->action960_x_540->setChecked(true);
    ui->action1280_x_720->setChecked(false);
    ui->action1920_x_1080->setChecked(false);
    ui->webView->setZoomFactor(1/1);
    browser->updateZoom(1/1);

    settings.setValue("resolution", "540p");
}

void MainWindow::on_action1280_x_720_triggered()
{
    ui->action960_x_540->setChecked(false);
    ui->action1280_x_720->setChecked(true);
    ui->action1920_x_1080->setChecked(false);
    ui->webView->setZoomFactor(0.75);
    browser->updateZoom(0.75);

    settings.setValue("resolution", "720p");
}

void MainWindow::on_action1920_x_1080_triggered()
{
    ui->action960_x_540->setChecked(false);
    ui->action1280_x_720->setChecked(false);
    ui->action1920_x_1080->setChecked(true);
    ui->webView->setZoomFactor(0.5);
    browser->updateZoom(0.5);

    settings.setValue("resolution", "1080p");
}

void MainWindow::on_actionReload_triggered()
{
    clearCache();
    this->loadUrl(QUrl(history.at(0)->property("url").toString()));
}

void MainWindow::on_actionBack_triggered()
{
    if (browser->isVisible()) {
        browser->history()->back();
    } else {
        ui->webView->history()->back();
    }
}

void MainWindow::on_webView_urlChanged(const QUrl &url)
{
    initialiseHistoryMenu();
}

void MainWindow::on_actionScrolling_triggered()
{
    bool flag = (ui->webView->page()->mainFrame()->scrollBarPolicy(Qt::Vertical) == Qt::ScrollBarAlwaysOff && ui->webView->page()->mainFrame()->scrollBarPolicy(Qt::Horizontal) == Qt::ScrollBarAlwaysOff);

    if (flag) {
        ui->actionScrolling->setChecked(true);
        ui->webView->page()->mainFrame()->setScrollBarPolicy(Qt::Vertical, Qt::ScrollBarAlwaysOn);
        ui->webView->page()->mainFrame()->setScrollBarPolicy(Qt::Horizontal, Qt::ScrollBarAlwaysOn);
    } else {
        ui->actionScrolling->setChecked(false);
        ui->webView->page()->mainFrame()->setScrollBarPolicy(Qt::Vertical, Qt::ScrollBarAlwaysOff);
        ui->webView->page()->mainFrame()->setScrollBarPolicy(Qt::Horizontal, Qt::ScrollBarAlwaysOff);
    }
}

void MainWindow::on_actionAbout_triggered()
{
    QMessageBox about;
    about.setWindowTitle("About Canoodle");
    about.setWindowFlags(Qt::Popup);
    about.setText("Canoodle");
    about.setInformativeText("A desktop simulator for WebKit-based smart TV applications.");
    about.setDetailedText("Code by Oliver Moran <omoran@tvtextbook.com>. Images by FEN <http://openclipart.org/user-detail/FEN> and remcovandermeer <http://www.flickr.com/photos/remmac>. (c) 2013 Avoca Learning <http://www.tvtextbook.com/>.");
    about.exec();
}

void MainWindow::on_actionQuirks_triggered()
{
    bool flag = QWebSettings::globalSettings()->testAttribute(QWebSettings::SiteSpecificQuirksEnabled);
    ui->actionQuirks->setChecked(!flag);
    QWebSettings::globalSettings()->setAttribute(QWebSettings::SiteSpecificQuirksEnabled, !flag);
}

void MainWindow::on_actionPrint_triggered()
{
    QPrinter printer;
    QPrintDialog *dialog = new QPrintDialog(&printer, this);
    dialog->setWindowTitle("Print");
    if (dialog->exec() == QDialog::Accepted) {
        ui->webView->print(&printer);
    }
}

void MainWindow::closeEvent(QCloseEvent *event) {
    QCoreApplication::quit();
}

void MainWindow::clearCache() {
    QWebSettings::clearMemoryCaches();
}

void MainWindow::on_webView_titleChanged(const QString &title)
{
    this->setWindowTitle(title);
}

void MainWindow::on_actionSave_Screen_Shot_triggered()
{
    QString format = "png";
    // QString initialPath = QDir::homePath() + "/" + this->windowTitle() + "." + format;
    QString initialPath = QDir::homePath() + "/screen_shot." + format;

    QString fileName = QFileDialog::getSaveFileName(
        this,
        tr("Save As"),
        initialPath,
        tr("%1 Files (*.%2);;All Files (*)").arg(format.toUpper()).arg(format)
    );
    if (!fileName.isEmpty()) {
        ui->webView->grab().save(fileName, format.toStdString().c_str(), 100); // 100 = maximal quality
    }
}
